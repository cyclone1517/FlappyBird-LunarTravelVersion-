{"version":3,"sources":["../../js/Director.js"],"names":["Object","defineProperty","exports","value","Director","undefined","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_DataStore","require","_UpPencil","_DownPencil","_classCallCheck","instance","TypeError","getIInstance","DataStore","DataStore","getInstance","moveSpeed","createPencil","minTop","DataStore","canvas","height","maxTop","top","Math","random","get","push","UpPencil","DownPencil","birdsEvent","y","birdsY","time","check","birds","land","pencils","score","birdsHeight","console","log","isGameOver","birdsBorder","bottom","left","birdsX","right","birdsWidth","pencil","pencilBorder","x","width","isStrike","isScore","scoreNumber","run","_this","draw","shift","window","innerWidth","forEach","index","array","timer","requestAnimationFrame","put","cancelAnimationFrame","destroy","bird","s"],"mappings":"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","file":"Director.js","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.Director = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); //导演类 控制游戏逻辑\n\n\nvar _DataStore = require(\"./base/DataStore.js\");\n\nvar _UpPencil = require(\"./runtime/UpPencil.js\");\n\nvar _DownPencil = require(\"./runtime/DownPencil.js\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Director = exports.Director = function () {\n    _createClass(Director, null, [{\n        key: \"getIInstance\",\n        value: function getIInstance() {\n            if (!Director.instance) {\n                Director.instance = new Director();\n            }\n            return Director.instance;\n        }\n    }]);\n\n    function Director() {\n        _classCallCheck(this, Director);\n\n        this.DataStore = _DataStore.DataStore.getInstance();\n        this.moveSpeed = 2;\n    }\n\n    _createClass(Director, [{\n        key: \"createPencil\",\n        value: function createPencil() {\n            var minTop = DataStore.getInstance().canvas.height / 8;\n            var maxTop = DataStore.getInstance().canvas.height / 2;\n            var top = minTop + Math.random() * (maxTop - minTop);\n            this.DataStore.get('pencils').push(new _UpPencil.UpPencil(top));\n            this.DataStore.get('pencils').push(new _DownPencil.DownPencil(top));\n        }\n    }, {\n        key: \"birdsEvent\",\n        value: function birdsEvent() {\n            for (var i = 0; i <= 2; i++) {\n                this.DataStore.get('birds').y[i] = this.DataStore.get('birds').birdsY[i];\n            }\n            this.DataStore.get('birds').time = 0;\n        }\n    }, {\n        key: \"check\",\n\n\n        //撞击判断\n        value: function check() {\n            var birds = this.DataStore.get('birds');\n            var land = this.DataStore.get('land');\n            var pencils = this.DataStore.get('pencils');\n            var score = this.DataStore.get('score');\n            //地板撞击判断\n            if (birds.birdsY[0] + birds.birdsHeight[0] >= land.y) {\n                //console.log(birds.birdsY[0] + ',' + birds.birdsHeight[0] + ',' + land.y);\n                console.log('撞击地板啦');\n                this.isGameOver = true;\n                return;\n            }\n\n            //小鸟的边框模型\n            var birdsBorder = {\n                top: birds.y[0],\n                bottom: birds.birdsY[0] + birds.birdsHeight[0],\n                left: birds.birdsX[0],\n                right: birds.birdsX[0] + birds.birdsWidth[0] - 5\n            };\n\n            //铅笔边框模型\n            var length = pencils.length;\n            for (var i = 0; i < length; i++) {\n                var pencil = pencils[i];\n                var pencilBorder = {\n                    top: pencil.y,\n                    bottom: pencil.y + pencil.height,\n                    left: pencil.x,\n                    right: pencil.x + pencil.width\n                };\n\n                if (Director.isStrike(birdsBorder, pencilBorder)) {\n                    console.log('撞到啦！');\n                    this.isGameOver = true;\n                }\n            }\n\n            //加分逻辑\n            // console.log(birds.birdsX[0] + ', ' + (pencils[0].x + pencils[0].width) +\n            //  ', ' + (birds.birdsX[0] > pencils[0].x + pencils[0].width));\n            if (birds.birdsX[0] > pencils[0].x + pencils[0].width && score.isScore) {\n                score.isScore = false;\n                score.scoreNumber++;\n            } else if (birds.birdsX[0] <= pencils[0].x + pencils[0].width) {\n                score.isScore = true;\n            }\n        }\n    }, {\n        key: \"run\",\n        value: function run() {\n            var _this = this;\n\n            this.check();\n            if (!this.isGameOver) {\n                this.DataStore.get('background').draw();\n                var pencils = this.DataStore.get('pencils');\n                if (pencils[0].x + pencils[0].width <= 0 && pencils.length === 4) {\n                    pencils.shift();\n                    pencils.shift();\n                }\n\n                if (pencils[0].x + pencils[0].width / 2 <= window.innerWidth / 2 && pencils.length === 2) {\n                    this.createPencil();\n                }\n\n                this.DataStore.get('pencils').forEach(function (value, index, array) {\n                    value.draw();\n                });\n\n                this.DataStore.get('land').draw();\n                this.DataStore.get('score').draw();\n                this.DataStore.get('birds').draw();\n\n                var timer = requestAnimationFrame(function () {\n                    return _this.run();\n                });\n                this.DataStore.put('timer', timer);\n            } else {\n                console.log('游戏结束');\n                this.DataStore.get('startButton').draw();\n                cancelAnimationFrame(this.DataStore.get('timer'));\n                this.DataStore.destroy();\n            }\n        }\n    }], [{\n        key: \"isStrike\",\n        value: function isStrike(bird, pencil) {\n            var s = false;\n            if (bird.top > pencil.bottom || bird.bottom < pencil.top || bird.right < pencil.left || bird.left > pencil.right) {\n                s = true;\n            }\n            //console.log(pencil.top + ',' + pencil.bottom + ',' +pencil.left + ',' + pencil.right);\n\n            return !s;\n        }\n    }]);\n\n    return Director;\n}();\n//# sourceMappingURL=Director.js.map"]}